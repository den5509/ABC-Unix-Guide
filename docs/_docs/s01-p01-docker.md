---
title: "Система управления контейнерами Docker"
permalink: /docs/s01-p01-docker/
redirect_from:
  - /theme-setup/
toc: true
---
Docker - клиент-серверная система управления контейнерами. Контейнер - это технология запуска приложений в изолированном окружении.

Docker удобно использовать для решения следующих задач:

- Развертывания легко переносимых веб-приложений, баз данных и сервисов.
- Запуска программного обеспечения, требующего разных дистрибутивов GNU/Linux.
- Создания легковесных PaaS окружений.

Docker запускает контейнер из файлов специального формата, называемых "образами". При запуске Docker создаёт в ОЗУ файловую систему bootfs, которая обеспечивает монтирование из образа корневой файловая системы rootfs (Debian, Ubuntu, CenOS \...). Файловая система rootfs монтируется «только для чтения». После запуска контейнера, поверх этой файловой системы монтируется файловая система на запись.

## Установка

Обновите индекс пакетов:

```
sudo apt-get update
```

Теперь можно загрузить и установить пакет Docker. Добавьте в систему GPG-ключ репозитория Docker:

```
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
```

Добавьте этот репозиторий в APT:

```
sudo add-apt-repository \
   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable"
```

Обновите индекс пакетов:

``` 
sudo apt-get update
```

Чтобы установить Docker, введите:

```
sudo apt-get install docker-ce
```

После этого программа Docker будет установлена; также это запустит демона и настроит автозапуск процесса. Чтобы убедиться в том, что программа работает, запросите её состояние:

```
sudo systemctl status docker    
```

## Настройка команды docker (опционально)
По умолчанию команда docker требует привилегий root (или доступа к команде sudo). Также её можно запускать в группе docker, которая создаётся автоматически во время установки программы Docker.

Если вы попытаетесь запустить команду docker без префикса sudo и вне группы docker, вы получите ошибку:

```
docker: Cannot connect to the Docker daemon. Is the docker daemon running on this host?.
See 'docker run --help'.    
```

Чтобы вам не пришлось набирать префикс sudo каждый раз когда вам нужно запустить команду docker, добавьте своего пользователя в группу docker:

```
sudo usermod -aG docker $(whoami)
```

Чтобы активировать это изменение, выйдите из системы и войдите снова.

Чтобы добавить в группу docker пользователя, который не является текущим, укажите в команде его имя:

```
sudo usermod -aG docker username  
```

## Основные команды

Docker установлен и готов к работе. Использование команд docker заключается в передаче ряда опций и команд с аргументами. Базовый синтаксис имеет такой вид:

```
docker [option] [command] [arguments]
```

Чтобы просмотреть все подкоманды, введите:

```
docker
```

В процессе работы вам может понядобятся такие команды как(формат docker \[команда\] \[опция/имя контейнера\]):

```
ps      - Список активных контейнеров;
ps -a   - Список всех контейнеров;
ps -l   - Список недавно созданных контейнеров;
start   - Запускает один или несколько остановленных контейнеров;
stop    - Останавливает контейнер;
exec    - Выполняет команду в запущенном контейнере (docker exec -it [имя контейнера] /bin/bash;
run     - Выполняет команду в новом контейнере;
search  - Поиск образа (serch [имя_образа]);
image   - Список образов; 
image rm - удаляет образ(необходимо для обновления образа).
```

Опции команды run, которые могут пригодится в работе:

```
-i  - запускает контейнер в интерактивном режиме;
-t  - запускает псевдотерминал, часто используется с -i (-ti);
-v  - пробрасывает директорию файловой системы внутрь контейнера [адрес_директории куда_в_контейнере_поместить];
--rm - удаляет контейнер после выхода из него;
--privileged  - дает все привелегии контейнеру, а также снимает все ограничения контроллера cgroup.
```

## Создание Dockerfile

Прежде всего, мы должны написать инструкцию, по которой Docker должен сформировать образ (image), на основе которого будет работать наше приложение --- Dockerfile. Этот файл должен носить имя \"Dockerfile\" и должен быть размещен в репозитории с лабораторной работой. В него помещается вся информация о контейнере, а именно:

1.  Указываем имя образа ОС;
2.  Автора образа и его email;
3.  Обновляем и очищаем;
4.  Устанавливаем пакеты необходимые для выполнения лабораторной работы;
5.  Создание пользователя student и установка паролей;
6.  Определяем каталог монтируемый с хоста в образ;
7.  Добавляем файлы для выполнение лабораторной работы внутри контейнера;
8.  Размещаем адрес скрипта, выводящего на экран отчет и запускающий bash;
9.  Ну и порт для проброса на хост.

Теперь немного о скрипте в нем необходимо указать всего два действия:

1.  Это команда cat и адрес расположения протокола лабораторной работы;
2.  Команда запуска bash /bin/bash;

## Сборка контейнера Build

Сборка образа локально:

```
docker build -t [имя образа] 
```

Запуск контейнера:

```
docker run -ti --rm --privileged [имя образа] 
```